const e=await import("../../token-action-hud-core/scripts/token-action-hud-core.min.js"),t=e.ActionHandler,i=e.ActionListExtender,s=e.CategoryManager,a=e.PreRollHandler,n=e.RollHandler,l=e.SystemManager,o=e.Logger,c="token-action-hud-titan";function getSetting(e,t=null){let i=t??null;try{i=game.settings.get(c,e)}catch{o.debug(`Setting '${e}' not found`)}return i}async function setSetting(e,t){game.settings.settings.get(`${c}.${e}`)?(t=await game.settings.set(c,e,t),o.debug(`Setting '${e}' set to '${t}'`)):o.debug(`Setting '${e}' not found`)}function localize(e){return game.i18n.localize(`tokenActionHud.titan.${e}.label`)}class ActionHandler extends t{async buildSystemActions(e,t,i){const s=t?.actor;return console.log(e),"character"===s?.type||"npc"===s?.type?this._buildCharacterActions(e,t,i):"vehicle"===s?.type?this._buildVehicleActions(e,t,i):s?void 0:this._buildMultipleTokenActions(e,i)}async _buildCharacterActions(e,t,i){const s=i.filter((e=>"equipped"===e||"consumables"===e||"containers"===e||"equipment"===e||"loot"===e||"tools"===e||"weapons"===e||"unequipped"===e)),a=i.filter((e=>"actions"===e||"bonus-actions"===e||"crew-actions"===e||"lair-actions"===e||"legendary-actions"===e||"reactions"===e||"other-actions"===e)),n=i.filter((e=>"passive-effects"===e||"temporary-effects"===e)),l=i.filter((e=>"active-features"===e||"passive-features"===e)),o=i.filter((e=>"cantrips"===e||"1st-level-spells"===e||"2nd-level-spells"===e||"3rd-level-spells"===e||"4th-level-spells"===e||"5th-level-spells"===e||"6th-level-spells"===e||"7th-level-spells"===e||"8th-level-spells"===e||"9th-level-spells"===e));i.some((e=>"abilities"===e))&&this._buildAbilities(e,t,"ability","abilities"),i.some((e=>"checks"===e))&&this._buildAbilities(e,t,"abilityCheck","checks"),a&&this._buildActions(e,t,a),i.some((e=>"combat"===e))&&this._buildCombat(e,t),i.some((e=>"conditions"===e))&&this._buildConditions(e,t),l&&this._buildFeatures(e,t,l),n&&this._buildEffects(e,t,n),s&&this._buildInventory(e,t,s),i.some((e=>"rests"===e))&&this._buildRests(e,t),i.some((e=>"saves"===e))&&this._buildAbilities(e,t,"abilitySave","saves"),i.some((e=>"skills"===e))&&this._buildSkills(e,t),o&&this._buildSpells(e,t,o),i.some((e=>"utility"===e))&&this._buildUtility(e,t)}async _buildVehicleActions(e,t,i){const s=i.filter((e=>"consumables"===e||"equipment"===e||"tools"===e||"weapons"===e)),a=i.filter((e=>"passive-effects"===e||"temporary-effects"===e||"inactive-effects"===e)),n=i.filter((e=>"active-features"===e||"passive-features"===e));i.some((e=>"abilities"===e))&&this._buildAbilities(e,t,"ability","abilities"),i.some((e=>"checks"===e))&&this._buildAbilities(e,t,"abilityCheck","checks"),i.some((e=>"combat"===e))&&this._buildCombat(e,t),i.some((e=>"conditions"===e))&&this._buildConditions(e,t),i.some((e=>"effects"===e))&&this._buildEffects(e,t,a),n&&this._buildFeatures(e,t),s&&this._buildInventory(e,t,s),i.some((e=>"saves"===e))&&this._buildAbilities(e,t,"abilitySave","saves"),i.some((e=>"utility"===e))&&this._buildUtility(e,t)}async _buildMultipleTokenActions(e,t){const i={actor:{id:"multi"},token:{id:"multi"}};t.some((e=>"abilities"===e))&&this._buildAbilities(e,i,"ability","abilities"),t.some((e=>"combat"===e))&&this._buildCombat(e,i),t.some((e=>"conditions"===e))&&this._buildConditions(e,i),t.some((e=>"checks"===e))&&this._buildAbilities(e,i,"abilityCheck","checks"),t.some((e=>"rests"===e))&&this._buildRests(e,i),t.some((e=>"saves"===e))&&this._buildAbilities(e,i,"abilitySave","saves"),t.some((e=>"skills"===e))&&this._buildSkills(e,i),t.some((e=>"utility"===e))&&this._buildUtility(e,i)}_buildAbilities(e,t,i,s){const a=t?.actor,n=t?.actor?.id,l=t.token?.id,o=getSetting("abbreviateSkills"),c="multi"===n?game.titan.config.abilities:a.system.abilities;if(0===c.length)return;const r=Object.entries(c).filter((e=>0!==c[e[0]].value)).map((e=>{const t=e[0],a=t.charAt(0).toUpperCase()+t.slice(1),r=o?a:game.titan.config.abilities[t],d=[i,n,l,t].join(this.delimiter);let u;return u="checks"===s?"":this._getProficiencyIcon(c[t].proficient),{id:t,name:r,encodedValue:d,icon:u,selected:!0}}));this.addActionsToActionList(e,r,s)}_buildActions(e,t,i){const s=t?.actor;if(!s)return;let a=s.items;0!==a.length&&(a=this._discardSlowItems(a),i.forEach((i=>{let s=null;switch(i){case"actions":s="action";break;case"bonus-actions":s="bonus";break;case"crew-actions":s="crew";break;case"lair-actions":s="lair";break;case"legendary-actions":s="legendary";break;case"reactions":s="reaction";break;case"other-actions":s=""}const n=a.filter((e=>e.system?.activation?.type===s));this._buildItems(e,t,n,i)})))}_buildCombat(e,t){const i=t?.actor?.id,s=t?.token?.id,a="utility",n={initiative:{id:"initiative",name:this.i18n("tokenActionHud.titan.rollInitiative")},endTurn:{id:"endTurn",name:this.i18n("tokenActionHud.endTurn")}};game.combat?.current?.tokenId!==s&&delete n.endTurn;const l=Object.entries(n).map((e=>{const t=e[1].id,n=e[1].name,l=[a,i,s,t].join(this.delimiter);let o="",c="";if("initiative"===e[0]&&game.combat){const e=canvas.tokens.controlled.map((e=>e.id)),t=game.combat.combatants.filter((t=>e.includes(t.tokenId)));if(1===t.length){o=t[0].initiative}c=`toggle${t.length>0&&t.every((e=>e?.initiative))?" active":""}`}return{id:t,name:n,encodedValue:l,info1:o,cssClass:c,selected:!0}}));this.addActionsToActionList(e,l,"combat")}_buildConditions(e,t){if(!t?.token)return;const i=t?.actor,s=t?.actor?.id,a=t?.token?.id,n="multi"===s?this._getActors():[i],l="condition",o=CONFIG.statusEffects.filter((e=>""!==e.id));if(0===o.length)return;const c=o.map((e=>{const t=e.id,i=this.i18n(e.label),o=[l,s,a,t].join(this.delimiter),c=n.every((e=>e.effects.map((e=>e.flags?.core?.statusId)).some((e=>e===t))))?" active":"",r=`toggle${c}`,d=e.icon;return{id:t,name:i,encodedValue:o,img:d,cssClass:r,selected:!0}}));this.addActionsToActionList(e,c,"conditions")}_buildEffects(e,t,i){const s=t?.actor,a="effect",n=s.effects;if(0!==n.size){if(i.some((e=>"passive-effects"===e))){const i=n.filter((e=>!e.isTemporary));this._buildItems(e,t,i,"passive-effects",a)}if(i.some((e=>"temporary-effects"===e))){const i=n.filter((e=>e.isTemporary));this._buildItems(e,t,i,"temporary-effects",a)}}}_buildFeatures(e,t,i){const s=t?.actor,a="feature";let n=s.items.filter((e=>"feat"===e.type));if(0!==n.length){if(n=this._discardSlowItems(n),n=this.sortItems(n),i.some((e=>"active-features"===e))){const i=n.filter((e=>{const t=e.system.activation.type;return t&&""!==t&&"lair"!==t&&"legendary"!==t}));this._buildItems(e,t,i,"active-features",a)}if(i.some((e=>"passive-features"===e))){const i=n.filter((e=>{const t=e.system.activation.type;return!t||""===t}));this._buildItems(e,t,i,"passive-features",a)}}}_buildInventory(e,t,i){const s=t?.actor,a=this._discardSlowItems(s.items.filter((e=>e.system.quantity>0)));if(0===a.length)return;const n=this.sortItems(a);if(i.some((e=>"equipped"===e))){const i=this._getActiveEquipment(n.filter((e=>e.system.equipped)));this._buildItems(e,t,i,"equipped")}if(i.some((e=>"unequipped"===e))){const i=this._getActiveEquipment(n.filter((e=>!e.system.equipped)));this._buildItems(e,t,i,"unequipped")}if(i.some((e=>"consumables"===e))){const i=this._getActiveEquipment(n.filter((e=>"consumable"===e.type))),s=this._discardExpendedItems(i);this._buildItems(e,t,s,"consumables")}let l;l=getSetting("showUnequippedItems")?n.filter((e=>"consumable"!==e.type&&"spell"!==e.type&&"feat"!==e.type)):n.filter((e=>"consumable"!==e.type&&e.system.equipped));const o=this._getActiveEquipment(l);if(i.some((e=>"containers"===e))){const i=o.filter((e=>"backpack"===e.type));this._buildItems(e,t,i,"containers")}if(i.some((e=>"equipment"===e))){const i=o.filter((e=>"equipment"===e.type));this._buildItems(e,t,i,"equipment")}if(i.some((e=>"loot"===e))){const i=o.filter((e=>"loot"===e.type));this._buildItems(e,t,i,"loot")}if(i.some((e=>"tools"===e))){const i=a.filter((e=>"tool"===e.type));this._buildItems(e,t,i,"tools")}if(i.some((e=>"weapons"===e))){const i=o.filter((e=>"weapon"===e.type));this._buildItems(e,t,i,"weapons")}}_buildItems(e,t,i,s,a="item"){if(0===i.length)return;const n=i.map((e=>this._getAction(a,t,e)));this.addActionsToActionList(e,n,s)}_getActiveEquipment(e){let t=[];if(getSetting("showItemsWithoutActivationCosts"))t=e;else{const i=Object.keys(game.titan.config.abilityActivationTypes).filter((e=>"none"!==e));t=e.filter((e=>!!e.system.activation&&i.includes(e.system.activation.type)))}return t}_getAction(e,t,i){const s=t?.actor,a=t?.actor?.id,n=t?.token?.id,l=i.id??i._id;let o=i?.name??i?.label;i?.system?.recharge&&!i?.system?.recharge?.charged&&i?.system?.recharge?.value&&(o+=` (${this.i18n("TITAN.Recharge")})`);let c="";if(Object.hasOwn(i,"disabled")){c=`toggle${i.disabled?"":" active"}`}const r=[e,a,n,l].join(this.delimiter),d=this.getImage(i),u=this._getIcon(i?.system?.activation?.type),m=this._getItemInfo(s,i);return{id:l,name:o,encodedValue:r,cssClass:c,img:d,icon:u,info1:m.info1,info2:m.info2,info3:m.info3,selected:!0}}_getItemInfo(e,t){return{info1:this._getQuantityData(t)??"",info2:this._getUsesData(t)??"",info3:this._getConsumeData(t,e)??""}}_buildRests(e,t){const i=t?.actor,s=t?.actor?.id,a=t?.token?.id;if(!("multi"===s?this._getActors():[i]).every((e=>"character"===e.type)))return;const n="utility",l={shortRest:{name:this.i18n("TITAN.ShortRest")},longRest:{name:this.i18n("TITAN.LongRest")}},o=Object.entries(l).map((e=>{const t=e[0],i=e[1].name,l=[n,s,a,t].join(this.delimiter);return{id:t,name:i,encodedValue:l,selected:!0}}));this.addActionsToActionList(e,o,"rests")}_buildSkills(e,t){const i=t?.actor,s=t?.actor?.id,a=t?.token?.id,n="skill",l=getSetting("abbreviateSkills"),c="multi"===s?game.titan.config.skills:i.system.skills;if(0===c.length)return;const r=Object.entries(c).map((e=>{try{const t=e[0],i=t.charAt(0).toUpperCase()+t.slice(1),o=l?i:game.titan.config.skills[t].label,r=[n,s,a,t].join(this.delimiter);return{id:t,name:o,encodedValue:r,icon:this._getProficiencyIcon(c[t].value)}}catch(t){return o.error(e),null}})).filter((e=>!!e));this.addActionsToActionList(e,r,"skills")}_buildSpells(e,t){const i=t?.actor;let s=i.items.filter((e=>"spell"===e.type));if(0===s.length)return;s=this._discardSlowItems(s),s=this._discardExpendedItems(s),s=this._discardNonPreparedSpells(i,s),s=this._sortSpellsByLevel(s);const a=Object.entries(i.system.spells).sort(((e,t)=>Intl.Collator().compare(t[0],e[0]))),n=a.find((e=>"pact"===e[0]));let l=!1;a.filter((e=>"maxLevel"!==e[0])).forEach((e=>{e[0].startsWith("spell")?(!l&&e[1].max>0&&e[1].value>0&&(l=!0),l||e[0]!=="spell"+n[1]?.level||n[1].max>0&&n[1].value>0&&(l=!0),e[1].slotsAvailable=l):(e[1]||(e[1]={}),e[1].slotsAvailable=!e[1].max||e[1].value>0)}));const o=a.findIndex((e=>"pact"===e[0]));if(!a[o][1].slotsAvailable){const e=a.findIndex((e=>e[0]==="spell"+n[1].level));a[o][1].slotsAvailable=a[e][1].slotsAvailable}const c=[...new Set(s.map((e=>{const t=e.system.preparation.mode,i=e.system.level;return!("pact"!==t&&"atwill"!==t&&"innate"!==t)?t:i})))].map((e=>e));for(const i of c){let n=null;switch(i){case 0:n="cantrips";break;case 1:n="1st-level-spells";break;case 2:n="2nd-level-spells";break;case 3:n="3rd-level-spells";break;case 4:n="4th-level-spells";break;case 5:n="5th-level-spells";break;case 6:n="6th-level-spells";break;case 7:n="7th-level-spells";break;case 8:n="8th-level-spells";break;case 9:n="9th-level-spells"}const l=i,o=!("pact"!==l&&"atwill"!==l&&"innate"!==l),c=a.find((e=>e[0]===`spell${l}`))?.[1],r=c?.value,d=c?.max,u=c?.slotsAvailable,m=getSetting("showUnchargedItems");if(d&&!u&&!m)continue;if(d>0){const t={};t.info1=`${r}/${d}`,this.addSubcategoryInfo(e,n,t)}const g=[];for(const e of s){if((o?e.system.preparation.mode:e.system.level)===l){const i=this._getAction("spell",t,e);getSetting("displaySpellInfo")&&this._addSpellInfo(e,i),g.push(i)}}this.addActionsToActionList(e,g,n)}}_sortSpellsByLevel(e){const t=Object.keys(e).map((t=>e[t]));return t.sort(((e,t)=>e.system.level===t.system.level?e.name.localeCompare(t.name):e.system.level-t.system.level)),t}_addSpellInfo(e,t){const i=e.system.components;t.info1="",t.info2="",t.info3="",i?.vocal&&(t.info1+=this.i18n("TITAN.ComponentVerbal").charAt(0).toUpperCase()),i?.somatic&&(t.info1+=this.i18n("TITAN.ComponentSomatic").charAt(0).toUpperCase()),i?.material&&(t.info1+=this.i18n("TITAN.ComponentMaterial").charAt(0).toUpperCase()),i?.concentration&&(t.info2+=this.i18n("TITAN.Concentration").charAt(0).toUpperCase()),i?.ritual&&(t.info3+=this.i18n("TITAN.Ritual").charAt(0).toUpperCase())}_buildUtility(e,t){const i=t?.actor,s=t?.actor?.id,a=t?.token?.id,n="multi"===s?this._getActors():[i];if(!n.every((e=>"character"===e.type)))return;const l="utility",o={deathSave:{name:this.i18n("TITAN.DeathSave")},inspiration:{name:this.i18n("TITAN.Inspiration")}};("multi"===s||i.system.attributes.hp.value>0)&&delete o.deathSave;const c=Object.entries(o).map((e=>{const t=e[0],i=e[1].name,o=[l,s,a,t].join(this.delimiter);let c="";if("inspiration"===e[0]){const e=n.every((e=>e.system.attributes?.inspiration))?" active":"";c=`toggle${e}`}return{id:t,name:i,encodedValue:o,cssClass:c,selected:!0}}));this.addActionsToActionList(e,c,"utility")}_getActors(){const e=["character","npc"],t=canvas.tokens.controlled.map((e=>e.actor));if(t.every((t=>e.includes(t.type))))return t}_getQuantityData(e){const t=e?.system?.quantity;return t>1?t:""}_getUsesData(e){let t="";const i=e?.system?.uses;return i?(t=0===i.value&&i.max?"0":i.value,i.max>0&&(t+=`/${i.max}`),t):t}_getConsumeData(e,t){let i="";const s=e?.system?.consume?.type;if(s&&""!==s){const a=e.system.consume.target,n=a.substr(0,a.lastIndexOf("."));if("attribute"===s){const e=getProperty(t,`system.${n}`);e&&(i=e.value??0,e.max&&(i+=`/${e.max}`))}if("charges"===s){const s=e.system.consume.target,a=t.items.get(s)?.system.uses;a?.value&&(i=a.value,a.max&&(i+=`/${a.max}`))}if("attribute"!==s&&"charges"!==s){const s=e.system.consume.target,a=t.items.get(s)?.system.quantity;a&&(i=a)}}return i}_discardSlowItems(e){let t;return getSetting("showSlowActions")||(t=e.filter((e=>!e.system.activation||!("minute"===e.system.activation.type||"hour"===e.system.activation.type||"day"===e.system.activation.type)))),t||e}_discardNonPreparedSpells(e,t){if("character"!==e.type&&getSetting("showUnequippedItems"))return;const i=Object.keys(game.titan.config.spellPreparationModes).filter((e=>"prepared"!==e));let s=t;return s=getSetting("showUnpreparedSpells")?t.filter((e=>e.system.preparation.prepared||i.includes(e.system.preparation.mode)||0===e.system.level)):t.filter((e=>e.system.preparation.prepared)),s}_discardExpendedItems(e){return getSetting("showUnchargedItems")?e:e.filter((e=>{const t=e.system.uses;return!t||!(t.max>0&&!t.value)}))}_getProficiencyIcon(e){return{0:"",.5:'<i class="fas fa-adjust"></i>',1:'<i class="fas fa-check"></i>',2:'<i class="fas fa-check-double"></i>'}[e]}_getIcon(e){return{bonus:'<i class="fas fa-plus"></i>',crew:'<i class="fas fa-users"></i>',day:'<i class="fas fa-hourglass-end"></i>',hour:'<i class="fas fa-hourglass-half"></i>',lair:'<i class="fas fa-home"></i>',minute:'<i class="fas fa-hourglass-start"></i>',legendary:'<i class="fas fa-dragon"></i>',reaction:'<i class="fas fa-bolt"></i>',special:'<i class="fas fa-star"></i>'}[e]}}class RollHandler extends n{async doHandleActionEvent(e,t){const i=t.split("|");4!==i.length&&super.throwInvalidValueErr();const s=i[0],a=i[1],n=i[2],l=i[3];if("multi"===n&&"toggleCombat"!==l)for(const t of canvas.tokens.controlled){const i=t.actor?.id,a=t.id;await this._handleMacros(e,s,i,a,l)}else await this._handleMacros(e,s,a,n,l)}async _handleMacros(e,t,i,s,a){switch(t){case"ability":this._rollAbility(e,i,s,a);break;case"abilityCheck":this._rollAbilityTest(e,i,s,a);break;case"abilitySave":this._rollAbilitySave(e,i,s,a);break;case"condition":if(!s)return;await this._toggleCondition(e,s,a);break;case"effect":await this._toggleEffect(e,i,s,a);break;case"feature":case"item":case"spell":case"weapon":this.isRenderItem()?this.doRenderItem(i,s,a):this._useItem(e,i,s,a);break;case"magicItem":this._rollMagicItem(e,i,s,a);break;case"skill":this._rollSkill(e,i,s,a);break;case"utility":await this._performUtilityMacro(e,i,s,a)}}_rollAbility(e,t,i,s){super.getActor(t,i).rollAbility(s,{event:e})}_rollAbilitySave(e,t,i,s){super.getActor(t,i).rollAbilitySave(s,{event:e})}_rollAbilityTest(e,t,i,s){super.getActor(t,i).rollAbilityTest(s,{event:e})}_rollMagicItem(e,t,i,s){const a=super.getActor(t,i),n=s.split(">"),l=n[0],o=n[1];MagicItems.actor(a.id).roll(l,o),Hooks.callAll("forceUpdateTokenActionHud")}_rollSkill(e,t,i,s){super.getActor(t,i).rollSkill(s,{event:e})}_useItem(e,t,i,s){const a=super.getActor(t,i),n=super.getItem(a,s);if(!this._needsRecharge(n))return n.use({event:e});n.rollRecharge()}_needsRecharge(e){return e.system.recharge&&!e.system.recharge.charged&&e.system.recharge.value}async _performUtilityMacro(e,t,i,s){const a=super.getActor(t,i),n=super.getToken(i);switch(s){case"deathSave":a.rollDeathSave({event:e});break;case"endTurn":if(!n)break;game.combat?.current?.tokenId===i&&await(game.combat?.nextTurn());break;case"initiative":await this._rollInitiative(t);break;case"inspiration":{const e=!a.system.attributes.inspiration;a.update({"data.attributes.inspiration":e});break}case"longRest":a.longRest();break;case"shortRest":a.shortRest();break;case"toggleCombat":if(0===canvas.tokens.controlled.length)break;await canvas.tokens.controlled[0].toggleCombat(),Hooks.callAll("forceUpdateTokenActionHud");break;case"toggleVisibility":if(!n)break;n.toggleVisibility(),Hooks.callAll("forceUpdateTokenActionHud")}}async _rollInitiative(e,t){const i=super.getActor(e,t);await i.rollInitiative({createCombatants:!0}),Hooks.callAll("forceUpdateTokenActionHud")}async _toggleCondition(e,t,i,s=null){const a=super.getToken(t),n=this.isRightClick(e);if(game.dfreds&&s?.flags?.isConvenient){const e=s.label;game.dfreds.effectInterface._toggleEffect(e)}else{const e=this.findCondition(i);if(!e)return;n?await a.toggleEffect(e,{overlay:!0}):await a.toggleEffect(e)}Hooks.callAll("forceUpdateTokenActionHud")}findCondition(e){return CONFIG.statusEffects.find((t=>t.id===e))}async _toggleEffect(e,t,i,s){const a=super.getActor(t,i),n=("find"in a.effects.entries?a.effects.entries:a.effects).find((e=>e.id===s));if(!n)return;this.isRightClick(e)?await n.delete():await n.update({disabled:!n.disabled}),Hooks.callAll("forceUpdateTokenActionHud")}}function register(e){const t="token-action-hud-titan";game.settings.register(t,"abbreviateSkills",{name:game.i18n.localize("tokenActionHud.titan.settings.abbreviateSkills.name"),hint:game.i18n.localize("tokenActionHud.titan.settings.abbreviateSkills.hint"),scope:"client",config:!0,type:Boolean,default:!1,onChange:t=>{e(t)}}),game.settings.register(t,"showSlowActions",{name:game.i18n.localize("tokenActionHud.titan.settings.showSlowActions.name"),hint:game.i18n.localize("tokenActionHud.titan.settings.showSlowActions.hint"),scope:"client",config:!0,type:Boolean,default:!0,onChange:t=>{e(t)}}),game.settings.register(t,"displaySpellInfo",{name:game.i18n.localize("tokenActionHud.titan.settings.displaySpellInfo.name"),hint:game.i18n.localize("tokenActionHud.titan.settings.displaySpellInfo.hint"),scope:"client",config:!0,type:Boolean,default:!0,onChange:t=>{e(t)}}),game.settings.register(t,"showUnchargedItems",{name:game.i18n.localize("tokenActionHud.titan.settings.showUnchargedItems.name"),hint:game.i18n.localize("tokenActionHud.titan.settings.showUnchargedItems.hint"),scope:"client",config:!0,type:Boolean,default:!1,onChange:t=>{e(t)}}),game.settings.register(t,"showUnequippedItems",{name:game.i18n.localize("tokenActionHud.titan.settings.showUnequippedItems.name"),hint:game.i18n.localize("tokenActionHud.titan.settings.showUnequippedItems.hint"),scope:"client",config:!0,type:Boolean,default:!0,onChange:t=>{e(t)}}),game.settings.register(t,"showUnpreparedSpells",{name:game.i18n.localize("tokenActionHud.titan.settings.showUnpreparedSpells.name"),hint:game.i18n.localize("tokenActionHud.titan.settings.showUnpreparedSpells.hint"),scope:"client",config:!0,type:Boolean,default:!0,onChange:t=>{e(t)}}),game.settings.register(t,"showItemsWithoutActivationCosts",{name:game.i18n.localize("tokenActionHud.titan.settings.showItemsWithoutActivationCosts.name"),hint:game.i18n.localize("tokenActionHud.titan.settings.showItemsWithoutActivationCosts.hint"),scope:"client",config:!0,type:Boolean,default:!1,onChange:t=>{e(t)}})}class SystemManager extends l{doGetCategoryManager(e){return new s(e)}doGetActionHandler(e,t){return new ActionHandler(e,t)}getAvailableRollHandlers(){return{core:"Core Titan"}}doGetRollHandler(e){return new RollHandler}doRegisterSettings(e){register(e)}async doRegisterDefaultFlags(){const e={categories:{inventory:{id:"attributes",title:localize("attributes"),subcategories:[{id:"attributes",title:localize("attributes"),type:"system"}]},skills:{id:"skills",title:localize("skills"),subcategories:[{id:"skills",title:localize("skills"),type:"system"}]},resistances:{id:"resistances",title:localize("resistances"),subcategories:[{id:"resistances",title:localize("resistances")}]},weapons:{id:"weapons",title:localize("weapons"),subcategories:[]},equipment:{id:"equipment",title:localize("equipment"),subcategories:[]},spells:{id:"spells",title:localize("spells"),subcategories:[]},utility:{id:"utility",title:localize("utility"),subcategories:[]}},subcategories:[{id:"attributes",title:localize("attributes")},{id:"skills",title:localize("skills")},{id:"resistances",title:localize("resistances")},{id:"weapons",title:localize("weapons")},{id:"equipment",title:localize("attributes")},{id:"spells",title:localize("spells")},{id:"utility",title:localize("utility")}]},t=foundry.utils.deepClone(e);e.defaults=t,await game.user.update({flags:{"token-action-hud-core":e}})}}export{ActionHandler,t as CoreActionHandler,i as CoreActionListExtender,s as CoreCategoryManager,a as CorePreRollHandler,n as CoreRollHandler,l as CoreSystemManager,o as Logger,RollHandler,SystemManager,getSetting,localize,register,setSetting};
